var O=2*Math.PI,st=(t,e=0,r=1)=>e+(r-e)*t,v=(t,e=0,r=0)=>t<r?r:t>e?e:t,T=(t=0,e=0)=>Math.random()*(t-e)+e,k=(...t)=>Math.floor(T(...t)),ot=t=>{if(t===void 0||typeof t!="function")throw new TypeError("Missing callback");let e=i=>window.requestAnimationFrame(i),r,s=i=>{t(i,r),r&&(r=e(s))},n=()=>(r=r||e(s),r),a=()=>(r=r&&window.cancelAnimationFrame(r),r);return{start:n,stop:a,play:n,pause:a}};function nt(...t){let e=ft(...t);return{gl:e,createFramebuffer:dt(e),createIbo:ht(e),createProgram:it(e),createTexture:ct(e),createVbo:ut(e),getUniformLocations:lt(e)}}function at(t){return e=>r=>{let s=t.createShader(e);if(t.shaderSource(s,r),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error(`glx: failed to compile shader: ${t.getShaderInfoLog(s)}`);return s}}function it(t){let e=at(t),r=e(t.FRAGMENT_SHADER),s=e(t.VERTEX_SHADER);return(n,a)=>{let i=t.createProgram(),h=r(a),u=s(n);if(t.attachShader(i,h),t.attachShader(i,u),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw new Error(`glx: failed to link program: ${t.gl.getProgramInfoLog(i)}`);if(t.deleteShader(h),t.deleteShader(u),t.validateProgram(i),!t.getProgramParameter(i,t.VALIDATE_STATUS))throw new Error(`glx: failed to validate program: ${t.gl.getProgramInfoLog(i)}`);return i}}function ct(t){return function(r){let s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),new Promise((n,a)=>{if(r){let i=new Image;i.onerror=h=>{a(h)},i.onload=()=>{let{width:h,height:u}=i;t.texImage2D(t.TEXTURE_2D,0,t.RGBA,h,u,0,t.RGBA,t.UNSIGNED_BYTE,i),n(s)},i.src=r}else n(s)})}}function ut(t){return(e,r=t.STATIC_DRAW)=>{let s=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,e,r),t.bindBuffer(t.ARRAY_BUFFER,null),s}}function ht(t){return(e,r=t.STATIC_DRAW)=>{let s=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,r),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),s}}function dt(t){return(e,r=e)=>{let s=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,s),t.viewport(0,0,e,r),s}}function lt(t){return(e,r)=>{let s={};for(let n of r)s[n]=t.getUniformLocation(e,n);return s}}function ft(t,e){let{types:r,attributes:s}={types:["webgl2","webgl","experimental-webgl"],attributes:{antialias:!0},...e};for(let n of r)try{let a=t?.getContext(n,s);if(a)return a;throw new Error("glx: failed to create WebGL context")}catch(a){throw a}}var mt=`#version 300 es
in vec2 aPosition;

uniform vec2 uResolution;

out vec2 vTextureCoord;

void main() {
  // Convert from pixels to 0 -> 1.
  vTextureCoord = aPosition / uResolution;

  gl_Position = vec4(((vTextureCoord * 2.0) - 1.0) * vec2(1, -1), 0, 1);
}`,pt=`#version 300 es
precision highp float;

in vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uThreshold;

out vec4 oColor;

void main() {
  vec4 c = texture(uSampler, vTextureCoord);
  float metaball = c.a > uThreshold ? 1.0 : 0.0;

  c.a = metaball;
  c.rgb = c.rgb * metaball;

  oColor = c;
}`,A=class{constructor(e=0,r=0){this.x=e,this.y=r}angle(){return Math.atan2(this.y,this.x)}length(){return Math.hypot(this.x,this.y)}dot(e={}){let{x:r=e,y:s=e}=e;return this.x*r+this.y*s}add(e={}){let{x:r=e,y:s=e}=e;return b(this.x+r,this.y+s)}subtract(e={}){let{x:r=e,y:s=e}=e;return b(this.x-r,this.y-s)}multiply(e={}){let{x:r=e,y:s=e}=e;return b(this.x*r,this.y*s)}divide(e={}){let{x:r=e,y:s=e}=e;return b(this.x/r,this.y/s)}plus(e){return this.copy(this.add(e))}minus(e){return this.copy(this.subtract(e))}times(e){return this.copy(this.multiply(e))}over(e){return this.copy(this.divide(e))}copy(e={}){let{x:r=e,y:s=e}=e;return this.x=r,this.y=s,this}clone(){return b(this.x,this.y)}equals(e){return this.x===e.x&&this.y===e.y}invert(){return this.times(-1)}normalize(){return this.over(this.length())}};function b(t,e){return new A(t,e)}var bt=(t=0,e=1)=>({x:e*Math.cos(t),y:e*Math.sin(t)});function X(t,e,r,s){return(1-s)*(1-s)*t+2*(1-s)*s*r+s*s*e}function Et(t){return[parseInt(t.substring(1,3),16),parseInt(t.substring(3,5),16),parseInt(t.substring(5,7),16)]}function Tt(t,e=performance.now()){return(r=e,s=250)=>{r-e<=s&&t(e),e=r}}function xt(t=0,e=2){if(t===0)return"0 b";let r=["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],s=Math.max(0,e),n=Math.floor(Math.log(t)/Math.log(1024));return`${parseFloat((t/Math.pow(1024,n)).toFixed(s))} ${r[n]}`}function x(t=""){return document.createRange().createContextualFragment(t)}var gt=["#fa5619","#243470","#efc126","#0d070b","#fffffd"],{createObjectURL:Rt,revokeObjectURL:wt}=self.URL||self.webkitURL,yt=gt.map(t=>new Promise((e,r)=>{let[s,n,a]=Et(t),i=`<svg
      height="10"
      width="10"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink">
      <defs>
        <radialGradient id="gradient">
          <stop offset="0%" stop-color="rgba(${s}, ${n}, ${a}, 0.9)" />
          <stop offset="90%" stop-color="rgba(${s}, ${n}, ${a}, 0.0)" />
        </radialGradient>
      </defs>
      <circle cx="5" cy="5" r="5" fill="url('#gradient')" />
    </svg>`,h=new Blob([i],{type:"image/svg+xml"}),u=Rt(h),p=new Image;p.onload=()=>{wt(u),e(p)},p.onerror=R=>{r(R)},p.src=u})),G=await Promise.all(yt);function Y(){let t=G.shift();return G.push(t),t}var P=class extends A{constructor(e,r){super(e,r),this.t=performance.now()}},F=class{constructor(e=0,r=0,s=0){this.x=e,this.y=r,this.r=s,this.d=2*s}},I=class{constructor(e=1){this.brush=new Y,this.drops=[],this.steps=[],this.sensitivity=e}draw(e){for(;this.drops.length>0;){let{x:r,y:s,r:n,d:a}=this.drops.shift();e.drawImage(this.brush,r-n,s-n,a,a)}return this}tick(e=performance.now()){if(this.steps=this.steps.filter(c=>e-c.t<200),e-this?.lastStep?.t>7.5&&this.step(this.lastStep.x,this.lastStep.y),this.done)return delete this.lastStep,delete this.lastTail,this;let{0:r,[this.steps.length-1]:s}=this.steps,n=this.lastTail??this.steps.at(-2)??r,a=s;this.lastTail=s;let i=1/(this.steps.length*this.sensitivity),h=[...this.steps].reverse().reduce((c,d,l,U)=>l?c.concat(d.subtract(U[l-1])):c,[]).reduce((c,d)=>c.add(d),b()).times(i),u=h.length(),p=a.subtract(n),R=n.add(p.multiply(.5)).add(h.multiply(Math.max(0,1-Math.log(u)))),Z=Math.max(2,(u-10)*.25+T(-2,2)),J=1/p.length();for(let c=0;c<=1;c+=J){let d=X(n.x,a.x,R.x,c),l=X(n.y,a.y,R.y,c);this.drop(d,l,Z)}Array.from({length:v(k(Math.max(0,u-20)*5),1e3)},()=>u).map(c=>c*.05).forEach(c=>{let d=st(Math.min(1,c),Math.random(),Math.pow(Math.random(),4)*c),l=T(Math.PI,-Math.PI)/3,U=-1*Math.sin(l)*Math.cos(l),tt=Math.pow(Math.random(),4)*Math.min(1/d,1)*u*.5,{x:et,y:rt}=b(h.multiply(d).dot(U)).plus(a);this.drop(et,rt,tt)});let N=s.t-r.t,Q=T(N*.1),q=T(N*.3);return Array.from({length:v(2-u/5,1e3)},()=>T(O)).map(c=>bt(c,q)).forEach(c=>{let{x:d,y:l}=s.add(c);this.drop(d,l,Q)}),this}drop(e,r,s){let n=new F(e,r,s);this.drops.push(n)}step(e,r){return this.lastStep=new P(e,r),this}set lastStep(e){this.steps.push(e)}get done(){return this.steps.length===0}},L=class{constructor(e=0,r=e,s=0){this.max=s,this.x=e,this.y=r}reset(e,r,s){this.max=s??this.max,this.x=e??this.x,this.y=r??this.y}walk(e=1,r=this.max){let s=Math.min(e,r),n=k(O);return this.x+=s*Math.cos(n),this.y+=s*Math.sin(n),this}},vt=(t=Math.random())=>Math.tan(Math.PI*(t-.5)),At=t=>(e=Math.random())=>1/Math.pow(1-e,1/t),S=document.querySelector("#save"),E=document.querySelector("progress"),St=document.querySelector("#clear"),w=document.querySelector("#draw"),g=document.querySelector("#statusline"),M=document.querySelector("canvas"),$=ot(Ot),_t={preserveDrawingBuffer:!0},{gl:o,createVbo:Mt,createProgram:Ut}=nt(M,{attributes:_t}),B=M.cloneNode().getContext("2d"),{width:f,height:m}=M;console.log(o);var Pt=[1,1,1],Ft=[...Pt,0],It=Float32Array.BYTES_PER_ELEMENT,V=new Float32Array([0,0,0,m,f,0,f,0,0,m,f,m]),y=Ut(mt,pt),Lt=Mt(V),D=o.getAttribLocation(y,"aPosition");D!==-1&&o.enableVertexAttribArray(D);var Bt=o.getUniformLocation(y,"uResolution"),Dt=o.getUniformLocation(y,"uSampler"),Ct=o.getUniformLocation(y,"uThreshold"),W=o.createTexture();o.activeTexture(o.TEXTURE0+0);o.bindTexture(o.TEXTURE_2D,W);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST);o.useProgram(y);var{searchParams:C}=new URL(document.location),kt=C.has("cauchy")?vt:At(1.26),$t=C.has("duration")?C.get("duration"):10;200*parseInt($t,10);var H=new I,Nt=(...t)=>Array.from({length:t.length},(e,r)=>k(0,t.at(r))),Xt=[f,m].map(t=>t*.5),Gt=Tt(()=>{H.brush=new Y}),z=[],_=new Proxy(z,{set(t,e,r){let s=Reflect.set(t,e,r);if(t.length&&e==="length"){let n=parseInt(t.length%20/20*100,10),a=String(n).padStart(3," ");n?(g.replaceChildren(x(`Running&hellip; <code>${a}%</code>`)),E.setAttribute("value",n),S.removeAttribute("disabled")):(g.replaceChildren(x(`Okay, <code>${t.length}</code> frames in store`)),E.setAttribute("value",0),w.removeAttribute("disabled"))}return t.length&&t.length%20===0&&$.stop(),t.length?S.removeAttribute("disabled"):w.removeAttribute("disabled"),s}}),j=new L(...Xt,50),K=new Worker("worker.js");K.addEventListener("message",t=>{let{image:e,step:r,error:s}=t.data;if(s&&(E.setAttribute("value",0),console.error(s)),r){let{index:n,total:a}=r,{length:i}=String(a),h=parseInt((n+1)/a*100,10),u=String(h).padStart(i," ");g.replaceChildren(x(`Processing&hellip; <code>${u}%</code>`)),E.setAttribute("value",h)}if(e){let{data:n,size:a}=e,i=`Splash.${Date.now()}.gif`,h=`<a href="data:image/gif;base64,${n}" download="${i}"><strong>${i}</strong></a>`,u=xt(a);_.splice(0,_.length),g.replaceChildren(x(`All set! ${h} <code>${u}</code>`)),E.setAttribute("value",0)}});w.addEventListener("click",function(){w.setAttribute("disabled",""),g.replaceChildren(x("Running&hellip;")),j.reset(...Nt(f,m)),E.removeAttribute("value"),$.start()},{passive:!0});St.addEventListener("click",function(){B.clearRect(0,0,f,m),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)});S.addEventListener("click",function(){_.length!==0&&(w.setAttribute("disabled",""),S.setAttribute("disabled",""),g.replaceChildren(x("Uploading&hellip;")),K.postMessage({store:z}),E.removeAttribute("value"),$.stop())},{passive:!0});function Ot(t,e){let r=kt(),s=j.walk(r),n=v(s.x,f),a=v(s.y,m);H.step(n,a).tick().draw(B),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,f,m,0,o.RGBA,o.UNSIGNED_BYTE,B.canvas),o.generateMipmap(o.TEXTURE_2D),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(...Ft),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.bindBuffer(o.ARRAY_BUFFER,Lt),o.uniform2f(Bt,f,m),o.uniform1i(Dt,W),o.uniform1f(Ct,.75),o.vertexAttribPointer(D,2,o.FLOAT,o.TRUE,2*It,0),o.drawArrays(o.TRIANGLES,0,V.length/2),e%100===0&&Gt(),e%10===0&&_.push(M.toDataURL())}
